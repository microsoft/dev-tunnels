pool:
  name: Azure Pipelines

# Publish only if changes to csharp directory are committed to main.
trigger:
  branches:
    include:
    - main
  paths:
    include:
    - csharp

steps:
  - template: csharp-build-steps.yaml

  - task: DotNetCoreCLI@2
    inputs:
      command: 'pack'
      workingDirectory: 'csharp'
      projects: 'csharp/dirs.proj'
      verbosity: 'Minimal'
      feedsToUse: Select
      nugetFeedType: 'internal'
      publishVstsFeed: VS
      publishPackageMetadata: true
      versioningScheme: 'byEnvVar'
      versionEnvVar: 'PackageVersion'
      packagesToPack: 'csharp/**/*.csproj'

  - task: DotNetCoreCLI@2
    inputs:
      command: 'push'
      workingDirectory: 'csharp'
      projects: 'csharp/dirs.proj'
      verbosity: 'Minimal'
      feedsToUse: Select
      nugetFeedType: 'internal'
      publishVstsFeed: VS
      publishPackageMetadata: true
      versioningScheme: 'byEnvVar'
      versionEnvVar: 'PackageVersion'
      packagesToPack: 'csharp/**/*.csproj'